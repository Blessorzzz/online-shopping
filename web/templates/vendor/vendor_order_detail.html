{% extends 'vendor/vendor_base.html' %}
{% load i18n %}
{% block content %}
<div class="order-detail-container" style="max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);">
    <h2 style="color: #333; margin-bottom: 20px;">{% trans "Order Details - PO Number:" %} {{ order.po_number }}</h2>
    <p><strong>{% trans "Customer:" %}</strong> {{ order.customer.username }}</p>
    <p><strong>{% trans "Purchase Date:" %}</strong> {{ order.purchase_date }}</p>
    <p><strong>{% trans "Total Amount:" %}</strong> ${{ order.total_amount }}</p>
    <p><strong>{% trans "Status:" %}</strong> {{ order.status }}</p>

    <h3 style="margin-top: 20px;">{% trans "Order Items" %}</h3>
    <table class="order-items-table" style="width: 100%; border-collapse: collapse; margin-top: 10px;">
        <thead>
            <tr>
                <th style="border: 1px solid #ddd; padding: 8px; background-color: #f4f4f4;">{% trans "Product Name" %}</th>
                <th style="border: 1px solid #ddd; padding: 8px; background-color: #f4f4f4;">{% trans "Quantity" %}</th>
                <th style="border: 1px solid #ddd; padding: 8px; background-color: #f4f4f4;">{% trans "Price" %}</th>
                <th style="border: 1px solid #ddd; padding: 8px; background-color: #f4f4f4;">{% trans "Subtotal" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order_items %}
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">{{ item.product.product_name }}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">{{ item.quantity }}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: right;">${{ item.product.price }}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: right;">${{ item.subtotal }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" style="border: 1px solid #ddd; padding: 8px; text-align: center;">{% trans "No items in this order." %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>


    <form method="post" style="margin-top: 20px; text-align: center;">
        {% csrf_token %}
        <label for="status">{% trans "Change Order Status:" %}</label>
        <select name="status" id="status">
            {% for value, display in order.STATUS_CHOICES %}
            <option value="{{ value }}" {% if order.status == value %}selected{% endif %}>{{ display }}</option>
            {% endfor %}
        </select>
        <button type="submit" style="display: inline-block; padding: 10px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px; transition: background 0.3s;">
            {% trans "Update Status" %}
        </button>
    </form>
    
    <div class="status-dates" style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
        <h4 style="margin-bottom: 12px;">{% trans "Status History" %}</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            {% if order.shipment_date %}
            <div class="date-item">
                <span style="font-weight: 500;">{% trans "Shipped Date:" %}</span>
                {{ order.shipment_date|date:"Y-m-d H:i" }}
            </div>
            {% endif %}
            
            {% if order.cancel_date %}
            <div class="date-item">
                <span style="font-weight: 500;">{% trans "Cancelled Date:" %}</span>
                {{ order.cancel_date|date:"Y-m-d H:i" }}
            </div>
            {% endif %}
            
            {% if order.ticket_issue_date %}
            <div class="date-item">
                <span style="font-weight: 500;">{% trans "Ticket Issued Date:" %}</span>
                {{ order.ticket_issue_date|date:"Y-m-d H:i" }}
            </div>
            {% endif %}
            
            {% if order.refund_date %}
            <div class="date-item">
                <span style="font-weight: 500;">{% trans "Refund Date:" %}</span>
                {{ order.refund_date|date:"Y-m-d H:i" }}
            </div>
            {% endif %}

            {% if order.hold_date %}
            <div class="date-item">
                <span style="font-weight: 500;">{% trans "hold_date:" %}</span>
                {{ order.hold_date|date:"Y-m-d H:i" }}
            </div>
            {% endif %}

            {% if order.complete_date %}
            <div class="date-item">
                <span style="font-weight: 500;">{% trans "complete_date:" %}</span>
                {{ order.complete_date|date:"Y-m-d H:i" }}
            </div>
            {% endif %}

            {% if order.pending_date %}
            <div class="date-item">
                <span style="font-weight: 500;">{% trans "pending_date:" %}</span>
                {{ order.pending_date|date:"Y-m-d H:i" }}
            </div>
            {% endif %}
        </div>
    </div>

    <div style="margin-top: 20px; text-align: center;">
        <a href="{% url 'vendor_orders' %}" class="back-to-orders-button" style="display: inline-block; padding: 10px 20px; background-color: #ED7014; color: white; text-decoration: none; border-radius: 5px; transition: background 0.3s;">
            {% trans "Back to Orders" %}
        </a>
    </div>    
</div>

<style>
    .status-dates {
        border: 1px solid #e0e0e0;
        background: #fff;
    }
    
    .date-item {
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
        border: 1px solid #eee;
    }
</style>
{% endblock %}
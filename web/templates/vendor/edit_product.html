<!-- filepath: /Users/williamchan/Desktop/ISI/django_project/online-shopping/web/templates/vendor/edit_product.html -->
{% extends 'vendor/vendor_base.html' %}
{% block content %}
<div class="container" style="max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); text-align: center;">
    <h2 style="color: #333; margin-bottom: 20px;">Edit Product</h2>
    <form method="post" enctype="multipart/form-data" onsubmit="return validateForm()" style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
        {% csrf_token %}
        <div style="width: 100%; text-align: left;">
            {{ form.product_name.label_tag }} {{ form.product_name }}
            {{ form.price.label_tag }} {{ form.price }}
            {{ form.description.label_tag }} {{ form.description }}
            {{ form.thumbnail_image.label_tag }} {{ form.thumbnail_image }}
        </div>
        <div class="thumbnail-container">
            <img src="{{ product.thumbnail_image.url }}" onclick="openModal()">
        </div>
        <div style="width: 100%; text-align: left;">
            {{ form.stock_quantity.label_tag }} {{ form.stock_quantity }}
            {{ form.min_age.label_tag }} {{ form.min_age }}
            {{ form.max_age.label_tag }} {{ form.max_age }}
        </div>
        <style>
            textarea {
                height: 150px;
                resize: none;
                display: block;
                margin: auto;
            }
            input, select, textarea {
                width: 100%;
                padding: 8px;
                margin-top: 5px;
                border: 1px solid #ccc;
                border-radius: 5px;
                text-align: center;
            }
            .error-message {
                color: red;
                font-size: 14px;
                display: none;
                margin-top: 5px;
            }
            .thumbnail-container {
                text-align: center;
                margin-top: 10px;
            }
            .thumbnail-container img {
                max-width: 200px;
                max-height: 200px;
                border-radius: 5px;
                border: 1px solid #ccc;
                margin-top: 5px;
                cursor: pointer; /* Change cursor to pointer */
            }
            .modal {
                display: none;
                position: fixed;
                z-index: 1;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgb(0,0,0);
                background-color: rgba(0,0,0,0.9);
            }
            .modal-content {
                margin: auto;
                display: block;
                width: 80%;
                max-width: 700px;
            }
            .close {
                position: absolute;
                top: 15px;
                right: 35px;
                color: #fff;
                font-size: 40px;
                font-weight: bold;
                transition: 0.3s;
            }
            .close:hover,
            .close:focus {
                color: #bbb;
                text-decoration: none;
                cursor: pointer;
            }
        </style>
        <script>
            function validateForm() {
                let fields = document.querySelectorAll("input, textarea, select");
                let price = document.querySelector("input[name='price']");
                let stock = document.querySelector("input[name='stock_quantity']");
                let minAge = document.querySelector("input[name='min_age']");
                let maxAge = document.querySelector("input[name='max_age']");
                let priceError = document.getElementById("price-error");
                let stockError = document.getElementById("stock-error");
                let emptyError = document.getElementById("empty-error");
                let ageError = document.getElementById("age-error");
                let isValid = true;
                
                priceError.style.display = "none";
                stockError.style.display = "none";
                emptyError.style.display = "none";
                ageError.style.display = "none";
                
                fields.forEach(field => {
                    if (field.hasAttribute("required") && field.value.trim() === "") {
                        isValid = false;
                    }
                });
                
                if (!isValid) {
                    emptyError.style.display = "block";
                    return false;
                }
                
                if (price.value <= 0) {
                    priceError.style.display = "block";
                    return false;
                }
                
                if (stock.value < 0) {
                    stockError.style.display = "block";
                    return false;
                }

                if (parseInt(minAge.value) > parseInt(maxAge.value)) {
                    ageError.style.display = "block";
                    return false;
                }
                
                return true;
            }

            function openModal() {
                document.getElementById('imageModal').style.display = "block";
                document.getElementById('modalImage').src = document.querySelector('.thumbnail-container img').src;
            }

            function closeModal() {
                document.getElementById('imageModal').style.display = "none";
            }
        </script>
        
        <div style="width: 100%; text-align: left;">
            <span id="empty-error" class="error-message">All fields must be filled out.</span>
            <span id="price-error" class="error-message">Price must be greater than zero.</span>
            <span id="stock-error" class="error-message">Stock quantity cannot be negative.</span>
            <span id="age-error" class="error-message">Minimum age cannot be greater than maximum age.</span>
        </div>
        <button type="submit" style="width: 100%; padding: 10px; background-color: #ED7014; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; transition: background 0.3s;">
            Save Changes
        </button>
    </form>
    <div style="margin-top: 15px;">
        <a href="{% url 'vendor_dashboard' %}" style="color: #ED7014; text-decoration: none; font-size: 14px;">Back to Dashboard</a>
    </div>
</div>

<!-- The Modal -->
<div id="imageModal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <img class="modal-content" id="modalImage">
</div>
{% endblock %}
{% extends "base.html" %}
{% load static i18n %}
{% block content %}

<main role="main" aria-label="{% trans 'Order Detail Page' %}">

<div class="order-container">

    <h2>{% trans "Order Details" %}</h2>

    <!-- 基础订单信息 -->
    <section class="order-info" aria-label="{% trans 'Order Information Section' %}">
        <p><strong>{% trans "P.O. Number:" %}</strong> {{ order.po_number }}</p>
        <p><strong>{% trans "Purchase Date:" %}</strong> {{ order.purchase_date|date:"DATETIME_FORMAT" }}</p>
        <p><strong>{% trans "Shipping Address:" %}</strong> {{ order.shipping_address }}</p>
        <p>
            <strong>{% trans "Total Amount:" %}</strong>
            <span class="total-amount" aria-label="{% trans 'Total amount' %}">${{ order.total_amount }}</span>
        </p>
        <p>
            <strong>{% trans "Status:" %}</strong>
            <span class="status-label status-{{ order.status }}" aria-label="{% trans 'Current order status is' %} {{ order.status|capfirst }}">
                {% if order.status == 'pending' %}⏳ Pending
                {% elif order.status == 'shipped' %}📦 Shipped
                {% elif order.status == 'cancelled' %}❌ Cancelled
                {% elif order.status == 'hold' %}⏸️ Hold
                {% elif order.status == 'ticket-issued' %}🎫 Ticket Issued
                {% elif order.status == 'complete' %}✅ Complete
                {% elif order.status == 'refunded' %}💰 Refunded
                {% elif order.status == 'delivered' %}📬 Delivered
                {% endif %}
            </span>
        </p>
    </section>

    <!-- 时间线区域 -->
    <section class="status-dates" aria-label="{% trans 'Order Status Timeline' %}">
        <h3>{% trans "Status History" %}</h3>
        <div class="timeline" role="list">
            {% for status, date in sorted_status_dates %}
            <div class="timeline-item" role="listitem" aria-label="{% trans status|capfirst %} on {{ date|date:'Y-m-d H:i' }}">
                <div class="timeline-marker" aria-hidden="true"></div>
                <div class="timeline-content">
                    <div class="status-card">
                        <span class="status-label">{{ status|title }}:</span>
                        <span class="status-date">{{ date|date:"Y-m-d H:i" }}</span>
                    </div>
                </div>
            </div>
            {% empty %}
            <p class="no-history" role="note">{% trans "No status history available" %}</p>
            {% endfor %}
        </div>
    </section>

    <!-- 商品明细表格 -->
    <section aria-label="{% trans 'Items in This Order' %}">
        <h3>{% trans "Items in this order:" %}</h3>

        <table class="order-table" role="table">
            <thead>
                <tr>
                    <th scope="col">{% trans "Product" %}</th>
                    <th scope="col">{% trans "Quantity" %}</th>
                    <th scope="col">{% trans "Unit Price" %}</th>
                    <th scope="col">{% trans "Subtotal" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items.all %}
                <tr>
                    <td>{{ item.product.product_name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>${{ item.price }}</td>
                    <td>${{ item.subtotal }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <!-- 返回按钮 -->
    <div class="back-link">
        <a href="{% url 'order_list' %}" class="back-button" aria-label="{% trans 'Back to order list' %}">
            {% trans "Back to Orders" %}
        </a>
    </div>
</div>

</main>

{% endblock %}
